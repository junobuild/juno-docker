#!/usr/bin/env bash

set -euo pipefail

ONLY_DEPS=0

for arg in "$@"; do
  if [[ "$arg" == "--only-deps" ]]; then
    ONLY_DEPS=1
    break
  fi
done

CANISTER="sputnik"
WITH_CERTIFICATION=1
BUILD_TYPE="extended"
TARGET="wasm32-wasip1"

SRC_ROOT_DIR="/juno/target/juno-main/src"

source "/juno/target/juno-main/docker/build-canister"

export CARGO_TARGET_DIR="/juno/target/juno-main/target"

build_canister "$CANISTER" "$SRC_ROOT_DIR" "." "$ONLY_DEPS" "$WITH_CERTIFICATION" "$BUILD_TYPE" "$TARGET"